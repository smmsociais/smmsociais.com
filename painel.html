<!DOCTYPE html>
<html id="theme_23" lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>New order</title>
    <style>
        /* Initial Load */
        body {
            visibility: hidden;
            opacity: 0;
            transition: opacity 240ms ease;
        }

        body.loaded {
            visibility: visible;
            opacity: 1;
        }

        #page-loader {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.9);
            z-index: 9999;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            min-width: 300px;
        }

        /* Estilo para a mensagem de sucesso */
        .success-message {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px 20px;
            border-radius: 4px;
            margin-top: 20px;
            text-align: center;
        }

        /* Ajustes para dispositivos pequenos */
        @media (max-width: 991.98px) {
            .success-message-mobile {
                margin: 20px 0;
                order: 1;
            }

            .new_order-block .row {
                display: flex;
                flex-direction: column;
            }

            .new_order-block .col-lg-7 {
                order: 2;
            }

            .new_order-block .col-lg-5 {
                order: 3;
            }
        }

        /* Estilo do bot√£o do WhatsApp */
        #whatsapp-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #25d366;
            border-radius: 50%;
            padding: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            transition: transform .2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            text-decoration: none;
        }

        #whatsapp-button:hover {
            transform: scale(1.1);
            background-color: #1da851;
        }

        #whatsapp-button img {
            width: 32px;
            height: 32px;
            filter: invert(1);
        }

        /* Search results (lista de servi√ßos sugeridos) */
        #service-search-results {
            position: relative;
            margin-top: 6px;
            max-height: 360px;
            overflow: auto;
            border-radius: 6px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            background: #fff;
            border: 1px solid #eee;
            z-index: 9998;
            font-size: 14px;
        }

        .service-result-item {
            padding: 10px 12px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        }

        .service-result-item:last-child {
            border-bottom: none;
        }

        .service-result-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .service-result-icon {
            font-size: 20px;
            width: 36px;
            text-align: center;
            line-height: 20px;
        }

        .service-result-body {
            flex: 1;
            min-width: 0;
        }

        .service-result-title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .service-result-sub {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-no-results {
            padding: 12px;
            color: #777;
        }

/* Estilos para o custom dropdown (copiando o tema) */
.custom-dropdown-wrapper {
    position: relative;
    width: 100%;
}

.custom-dropdown-toggle {
    width: 100%;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    display: flex;
    align-items: center;
    gap: 8px;
    text-align: left;
    cursor: pointer;
}

.custom-dropdown-toggle:hover {
    border-color: #adb5bd;
}

.custom-dropdown-toggle:focus {
    color: #495057;
    background-color: #fff;
    border-color: #80bdff;
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.custom-dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 1000;
    display: none;
    max-height: 250px;
    overflow-y: auto;
    background-color: #fff;
    border: 1px solid rgba(0, 0, 0, 0.15);
    border-radius: 0.25rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.175);
    margin-top: 2px;
}

.custom-dropdown-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0.375rem 1.5rem;
    clear: both;
    font-weight: 400;
    color: #212529;
    text-align: inherit;
    white-space: nowrap;
    background-color: transparent;
    border: 0;
    cursor: pointer;
    width: 100%;
    text-align: left;
}

.custom-dropdown-item:hover,
.custom-dropdown-item:focus {
    color: #16181b;
    text-decoration: none;
    background-color: #f8f9fa;
}

.custom-dropdown-item.active {
    color: #fff;
    text-decoration: none;
    background-color: #007bff;
}

.custom-dropdown-item .dropdown-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.custom-dropdown-item .dropdown-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.custom-dropdown-item .dropdown-text {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
}

.custom-dropdown-toggle .selected-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.custom-dropdown-toggle .selected-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.custom-dropdown-toggle .selected-text {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Ajuste para telas pequenas */
@media (max-width: 767.98px) {
    .custom-dropdown-menu {
        max-height: 200px;
    }
}      
        
    </style>
    <script>

        // coloque isto no topo do seu <script>, antes de qualquer fun√ß√£o que use categoryImages
        const categoryImages = {
            'Instagram': 'https://github.com/smmsociais/smmsociais.com/blob/9c93b12b9b4044c5e96392fbaf09bb42e74cb16a/instagram.png?raw=true',
            'Curtidas no Instagram': '‚ù§Ô∏è',
            'Seguidores Brasileiros no Instagram': 'https://github.com/smmsociais/smmsociais.com/blob/main/brasil.png?raw=true',
            'Curtidas Brasileiras no Instagram': 'https://github.com/smmsociais/smmsociais.com/blob/main/brasil.png?raw=true',
            'TikTok': 'https://github.com/smmsociais/smmsociais.com/blob/main/tiktok.png?raw=true'
            // adicione mais mapeamentos conforme as categorias reais retornadas pela API
        };

        // Fun√ß√£o para obter par√¢metros da URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const paramsObj = {};
            for (const [key, value] of params) {
                paramsObj[key] = value;
            }
            return paramsObj;
        }

        // Fun√ß√£o para obter o token do localStorage
        function loadToken() {
            const token = localStorage.getItem('authToken') ||
                localStorage.getItem('token') ||
                localStorage.getItem('user_token') ||
                localStorage.getItem('auth') ||
                getToken();
            return token;
        }

        // Fun√ß√£o para carregar saldo do usu√°rio
        async function loadUserBalance() {
            const token = loadToken();

            if (!token) {
                console.error("Token n√£o encontrado.");
                // Definir saldo como R$ 0,00 em caso de erro
                const balanceElement = document.querySelector('.component-navbar-balance-item__navbar-private');
                if (balanceElement) {
                    balanceElement.textContent = 'R$ 0,00';
                }
                return 0;
            }

            try {
                const response = await fetch('https://smmsociais.com/api/get_saldo', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Erro ao carregar saldo');
                }

                const balanceData = await response.json();

                // Formatar o saldo como moeda brasileira
                const formattedBalance = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(balanceData.saldo || 0);

                // Atualizar o saldo na navbar
                const balanceElement = document.querySelector('.component-navbar-balance-item__navbar-private');
                if (balanceElement) {
                    balanceElement.textContent = formattedBalance;
                }

                return balanceData.saldo;

            } catch (error) {
                console.error('Erro ao carregar saldo:', error);
                // Definir saldo como R$ 0,00 em caso de erro
                const balanceElement = document.querySelector('.component-navbar-balance-item__navbar-private');
                if (balanceElement) {
                    balanceElement.textContent = 'R$ 0,00';
                }
                return 0;
            }
        }

        // Fun√ß√£o para obter informa√ß√µes do usu√°rio
        async function getUserInfo() {
            const token = loadToken();

            if (!token) {
                console.error("Token n√£o encontrado.");
                return null;
            }

            try {
                const response = await fetch('https://smmsociais.com/api/account', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    // mostra o status e corpo para debug
                    const txt = await response.text().catch(() => null);
                    console.error('Erro ao carregar informa√ß√µes do usu√°rio. status:', response.status, txt);
                    throw new Error('Erro ao carregar informa√ß√µes do usu√°rio');
                }

                const userData = await response.json();
                console.log('getUserInfo response:', userData);

                // Normaliza campos esperados
                const normalized = {
                    userId: userData.userId || userData.id || userData._id || null,
                    nome_usuario: userData.nome_usuario || userData.nome || null,
                    email: userData.email || null,
                    token: userData.token || token
                };

                return normalized;
            } catch (error) {
                console.error('Erro ao carregar informa√ß√µes do usu√°rio:', error);
                return null;
            }
        }

        function generateRandomNumber() {
            return Math.floor(Math.random() * 90000) + 10000;
        }

        function hideInputAndDiv() {
            var input = document.getElementById('field-cpf_cnpj');
            var div = document.getElementById('order_cpf_cnpj');

            if (input) {
                input.style.display = 'none';
            }

            if (div) {
                div.style.display = 'none';
            }
        }

        function fillAndHideInput() {
            var input = document.getElementById('field-cpf_cnpj');
            if (input) {
                var randomNumber = generateRandomNumber();
                input.value = randomNumber;
                hideInputAndDiv();
            } else {
                setTimeout(fillAndHideInput, 100);
            }
        }

        // Fun√ß√£o para carregar servi√ßos da API
        function loadServices() {
            return fetch('https://smmsociais.com/api/servico')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao carregar servi√ßos da API');
                    }
                    return response.json();
                })
                .then(services => {
                    renderServices(services);
                    return services;
                })
                .catch(error => {
                    console.error('Erro ao carregar servi√ßos:', error);
                    const serviceSelect = document.getElementById('orderform-service');
                    if (serviceSelect) {
                        serviceSelect.innerHTML = '<option value="">Erro ao carregar servi√ßos</option>';
                    }
                    return [];
                });
        }

        // Fun√ß√£o para renderizar servi√ßos no formul√°rio
        function renderServices(services) {
            const serviceSelect = document.getElementById('orderform-service');
            if (!serviceSelect) return;

            // Limpar op√ß√µes existentes
            serviceSelect.innerHTML = '';

            // Adicionar op√ß√£o padr√£o
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Selecione um servi√ßo';
            serviceSelect.appendChild(defaultOption);

            // Adicionar servi√ßos da API
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id_servico;
                option.textContent = service.nome;
                option.setAttribute('data-price', service.preco_1000);
                option.setAttribute('data-min', service.minimo);
                option.setAttribute('data-max', service.maximo);
                option.setAttribute('data-description', service.descricao);
                option.setAttribute('data-rede', service.rede);
                option.setAttribute('data-tipo', service.tipo);
                serviceSelect.appendChild(option);
            });

            // Verificar se h√° um servi√ßo espec√≠fico na URL
            const urlParams = getUrlParams();
            const serviceIdFromUrl = urlParams.service;

            if (serviceIdFromUrl) {
                // Tentar selecionar o servi√ßo da URL
                selectServiceById(serviceIdFromUrl, services);
            } else {
                // Preencher automaticamente com o primeiro servi√ßo se n√£o houver par√¢metro
                if (services.length > 0) {
                    autoSelectFirstService(services);
                }
            }

            // Atualizar categorias com base nos servi√ßos
            updateCategories(services);

            // Configurar event listeners
            setupServiceEventListeners(services);
        }

        // Fun√ß√£o para selecionar servi√ßo por ID
        function selectServiceById(serviceId, services) {
            const serviceSelect = document.getElementById('orderform-service');
            if (!serviceSelect) return;

            // Encontrar o servi√ßo pelo ID
            const service = services.find(s => s.id_servico == serviceId);

            if (service) {
                // Encontrar a op√ß√£o correspondente no select
                for (let i = 0; i < serviceSelect.options.length; i++) {
                    if (serviceSelect.options[i].value == serviceId) {
                        serviceSelect.selectedIndex = i;

                        // Disparar o evento change para atualizar todos os campos
                        const event = new Event('change');
                        serviceSelect.dispatchEvent(event);

                        // Garantir que os campos sejam exibidos
                        showServiceFields();

                        console.log(`Servi√ßo selecionado automaticamente: ${service.nome} (ID: ${serviceId})`);
                        return;
                    }
                }
            }

            // Se n√£o encontrou o servi√ßo, usar o primeiro dispon√≠vel
            console.warn(`Servi√ßo com ID ${serviceId} n√£o encontrado. Selecionando primeiro servi√ßo dispon√≠vel.`);
            if (services.length > 0) {
                autoSelectFirstService(services);
            }
        }

        // Fun√ß√£o para preencher automaticamente o primeiro servi√ßo
        function autoSelectFirstService(services) {
            const serviceSelect = document.getElementById('orderform-service');
            if (serviceSelect && serviceSelect.options.length > 1) {
                // Selecionar o primeiro servi√ßo (√≠ndice 1, pois o √≠ndice 0 √© a op√ß√£o padr√£o)
                serviceSelect.selectedIndex = 1;

                // Disparar o evento change para atualizar todos os campos
                const event = new Event('change');
                serviceSelect.dispatchEvent(event);

                // Garantir que os campos sejam exibidos
                showServiceFields();
            }
        }

        // Fun√ß√£o para mostrar campos do servi√ßo
        function showServiceFields() {
            const linkField = document.getElementById('link_field');
            const quantityField = document.getElementById('quantity_field');
            const serviceDescription = document.getElementById('service_description');

            if (linkField) linkField.classList.remove('hidden');
            if (quantityField) quantityField.classList.remove('hidden');
            if (serviceDescription) serviceDescription.classList.remove('hidden');
        }

// helper: procura √≠cone/emoji no map categoryImages (case-insensitive)
function getCategoryImageForName(name) {
    if (!name) return null;
    
    // Busca exata primeiro
    for (let [key, value] of Object.entries(categoryImages)) {
        if (key.toLowerCase() === name.toLowerCase()) {
            return value;
        }
    }
    
    // Busca parcial
    for (let [key, value] of Object.entries(categoryImages)) {
        if (name.toLowerCase().includes(key.toLowerCase())) {
            return value;
        }
    }
    
    // Fallback baseado em palavras-chave
    const nameLower = name.toLowerCase();
    if (nameLower.includes('instagram')) return 'üì∑';
    if (nameLower.includes('tiktok')) return 'üéµ';
    if (nameLower.includes('youtube')) return '‚ñ∂Ô∏è';
    if (nameLower.includes('facebook')) return 'üë•';
    if (nameLower.includes('twitter')) return 'üê¶';
    if (nameLower.includes('telegram')) return 'üì±';
    if (nameLower.includes('curtida') || nameLower.includes('like')) return '‚ù§Ô∏è';
    if (nameLower.includes('seguidor') || nameLower.includes('follower')) return 'üë§';
    if (nameLower.includes('visualiza') || nameLower.includes('view')) return 'üëÄ';
    if (nameLower.includes('coment√°rio') || nameLower.includes('comment')) return 'üí¨';
    if (nameLower.includes('brasil') || nameLower.includes('brazil')) return 'üáßüá∑';
    
    return null; // Sem √≠cone padr√£o
}

 // Substitua a fun√ß√£o updateCategories por esta vers√£o completa
function updateCategories(services) {
    const categorySelect = document.getElementById('orderform-category');
    if (!categorySelect) return;

    // Limpar categorias existentes, mantendo apenas a op√ß√£o padr√£o
    while (categorySelect.options.length > 1) {
        categorySelect.remove(1);
    }

    const categories = new Map();

    services.forEach(service => {
        const name = (service.categoria || service.category_name || service.category || '').toString().trim();
        if (!name) return;
        if (categories.has(name)) return;

        // prioridade: icon enviado pelo servi√ßo, sen√£o tenta mapear pelo nome
        let icon = service.category_icon || getCategoryImageForName(name) || null;
        categories.set(name, icon);
    });

    // Preencher options do select nativo (para formul√°rio)
    categories.forEach((icon, name) => {
        const option = document.createElement('option');
        option.value = name;
        
        // Para o select nativo (valor do formul√°rio)
        option.textContent = name;
        if (icon) {
            option.setAttribute('data-icon', icon);
        }
        
        categorySelect.appendChild(option);
    });

    // Criar o custom dropdown visual
    createCustomCategoryDropdown(categorySelect);
}

// Fun√ß√£o para criar o custom dropdown
function createCustomCategoryDropdown(selectEl) {
    if (!selectEl || selectEl.__customDropdown) return;
    selectEl.__customDropdown = true;

    // Criar wrapper
    const wrapper = document.createElement('div');
    wrapper.className = 'custom-dropdown-wrapper';
    
    // Criar bot√£o de toggle
    const toggle = document.createElement('button');
    toggle.type = 'button';
    toggle.className = 'custom-dropdown-toggle form-control';
    toggle.setAttribute('aria-haspopup', 'true');
    toggle.setAttribute('aria-expanded', 'false');
    
    // Criar √≠cone selecionado
    const selectedIcon = document.createElement('div');
    selectedIcon.className = 'selected-icon';
    
    // Criar texto selecionado
    const selectedText = document.createElement('span');
    selectedText.className = 'selected-text';
    
    toggle.appendChild(selectedIcon);
    toggle.appendChild(selectedText);
    
    // Criar menu dropdown
    const menu = document.createElement('div');
    menu.className = 'custom-dropdown-menu';
    menu.setAttribute('role', 'menu');
    
    // Fun√ß√£o para atualizar o toggle
    function updateToggle() {
        const selectedOption = selectEl.options[selectEl.selectedIndex];
        if (selectedOption) {
            selectedText.textContent = selectedOption.textContent || 'Selecione uma categoria';
            
            const icon = selectedOption.getAttribute('data-icon');
            selectedIcon.innerHTML = '';
            
            if (icon) {
                if (icon.length <= 4 && /\p{Emoji}/u.test(icon)) {
                    // Emoji
                    selectedIcon.textContent = icon;
                } else if (icon.startsWith('http')) {
                    // Imagem URL
                    const img = document.createElement('img');
                    img.src = icon;
                    img.alt = '';
                    selectedIcon.appendChild(img);
                }
            }
        } else {
            selectedText.textContent = 'Selecione uma categoria';
            selectedIcon.innerHTML = '';
        }
    }
    
    // Fun√ß√£o para construir o menu
    function buildMenu() {
        menu.innerHTML = '';
        
        Array.from(selectEl.options).forEach((option, index) => {
            if (option.value === '') return; // Pular op√ß√£o vazia
            
            const item = document.createElement('button');
            item.type = 'button';
            item.className = 'custom-dropdown-item';
            item.setAttribute('role', 'menuitem');
            if (option.selected) {
                item.classList.add('active');
            }
            
            // Criar container do √≠cone
            const iconContainer = document.createElement('div');
            iconContainer.className = 'dropdown-icon';
            
            const icon = option.getAttribute('data-icon');
            if (icon) {
                if (icon.length <= 4 && /\p{Emoji}/u.test(icon)) {
                    // Emoji
                    iconContainer.textContent = icon;
                } else if (icon.startsWith('http')) {
                    // Imagem URL
                    const img = document.createElement('img');
                    img.src = icon;
                    img.alt = '';
                    iconContainer.appendChild(img);
                }
            }
            
            // Criar texto
            const text = document.createElement('span');
            text.className = 'dropdown-text';
            text.textContent = option.textContent;
            
            item.appendChild(iconContainer);
            item.appendChild(text);
            
            // Evento de clique
            item.addEventListener('click', () => {
                selectEl.selectedIndex = index;
                selectEl.dispatchEvent(new Event('change', { bubbles: true }));
                updateToggle();
                closeMenu();
            });
            
            menu.appendChild(item);
        });
    }
    
    // Fun√ß√µes para abrir/fechar menu
    function openMenu() {
        buildMenu();
        menu.style.display = 'block';
        toggle.setAttribute('aria-expanded', 'true');
        
        // Fechar ao clicar fora
        setTimeout(() => {
            document.addEventListener('click', closeOnClickOutside);
        }, 0);
    }
    
    function closeMenu() {
        menu.style.display = 'none';
        toggle.setAttribute('aria-expanded', 'false');
        document.removeEventListener('click', closeOnClickOutside);
    }
    
    function closeOnClickOutside(event) {
        if (!wrapper.contains(event.target)) {
            closeMenu();
        }
    }
    
    // Event listeners
    toggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        if (menu.style.display === 'block') {
            closeMenu();
        } else {
            openMenu();
        }
    });
    
    // Navega√ß√£o por teclado
    toggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            if (menu.style.display === 'block') {
                closeMenu();
            } else {
                openMenu();
            }
        } else if (e.key === 'Escape' && menu.style.display === 'block') {
            closeMenu();
        } else if ((e.key === 'ArrowDown' || e.key === 'ArrowUp') && menu.style.display !== 'block') {
            e.preventDefault();
            openMenu();
            if (menu.firstChild) menu.firstChild.focus();
        }
    });
    
    // Navega√ß√£o no menu
    menu.addEventListener('keydown', (e) => {
        const items = Array.from(menu.querySelectorAll('.custom-dropdown-item'));
        const currentIndex = items.indexOf(document.activeElement);
        
        switch (e.key) {
            case 'ArrowDown':
                e.preventDefault();
                const nextIndex = (currentIndex + 1) % items.length;
                items[nextIndex]?.focus();
                break;
            case 'ArrowUp':
                e.preventDefault();
                const prevIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;
                items[prevIndex]?.focus();
                break;
            case 'Enter':
            case ' ':
                e.preventDefault();
                document.activeElement?.click();
                break;
            case 'Escape':
                e.preventDefault();
                closeMenu();
                toggle.focus();
                break;
        }
    });
    
    // Esconder o select nativo mas mant√™-lo para o formul√°rio
    selectEl.style.position = 'absolute';
    selectEl.style.opacity = '0';
    selectEl.style.height = '1px';
    selectEl.style.width = '1px';
    selectEl.style.overflow = 'hidden';
    selectEl.style.clip = 'rect(0 0 0 0)';
    
    // Inserir no DOM
    wrapper.appendChild(toggle);
    wrapper.appendChild(menu);
    selectEl.parentNode.insertBefore(wrapper, selectEl.nextSibling);
    
    // Atualizar quando o select mudar
    selectEl.addEventListener('change', updateToggle);
    
    // Inicializar
    updateToggle();
}

            // --- preencher options (select nativo) ---
            categories.forEach((icon, name) => {
                const option = document.createElement('option');
                option.value = name;

                const isEmoji = icon && typeof icon === 'string' && icon.length <= 4 && /\p{Emoji}/u.test(icon);

                if (isEmoji) {
                    // Para emojis: adiciona o emoji diretamente no texto
                    option.textContent = `${icon} ${name}`;
                } else if (icon && icon.startsWith('http')) {
                    // Para imagens via URL: n√£o podemos mostrar no select nativo
                    // Mantemos apenas o nome, mas guardamos o √≠cone como data-atributo
                    option.textContent = name;
                    option.setAttribute('data-icon', icon);
                } else {
                    // Sem √≠cone ou √≠cone n√£o suportado
                    option.textContent = name;
                }

                // Adiciona data-icon para refer√™ncia se precisar em algum lugar
                if (icon) {
                    option.setAttribute('data-icon', icon);
                }

                categorySelect.appendChild(option);
            });

        function applyCategoryIconToNativeSelect(selectEl) {
            if (!selectEl) return;

            // pre-carrega imagens presentes nas options (melhora velocidade ao selecionar)
            Array.from(selectEl.options).forEach(opt => {
                const icon = opt.getAttribute('data-icon');
                if (icon && typeof icon === 'string' && icon.startsWith('http')) {
                    const img = new Image();
                    img.src = icon;
                    // opcional: tratar onerror se quiser fallback
                    img.onerror = () => {
                        // remove atributo caso a URL inv√°lida
                        try { opt.removeAttribute('data-icon'); } catch (e) { }
                    };
                }
            });

            function update() {
                const sel = selectEl.options[selectEl.selectedIndex];
                const iconVal = sel ? sel.getAttribute('data-icon') : null;

                if (!iconVal) {
                    // sem √≠cone -> limpa background e mant√©m padding padr√£o
                    selectEl.style.backgroundImage = '';
                    // se quiser reduzir padding quando n√£o houver √≠cone, comente a pr√≥xima linha
                    // selectEl.style.paddingLeft = '';
                    return;
                }

                // detectar emoji simples
                const isEmoji = typeof iconVal === 'string' && iconVal.length <= 4 && /\p{Emoji}/u.test(iconVal);
                if (isEmoji) {
                    // emoji: prefira t√™-lo diretamente no option.textContent (j√° feito no seu c√≥digo)
                    selectEl.style.backgroundImage = '';
                    return;
                }

                // tratar como URL: aplicamos como background do select
                try {
                    // for√ßa URL segura (escape aspas)
                    selectEl.style.backgroundImage = `url("${iconVal.replace(/"/g, '%22')}")`;
                    selectEl.style.backgroundSize = '20px 20px';
                    selectEl.style.backgroundPosition = '8px center';
                    selectEl.style.backgroundRepeat = 'no-repeat';
                    // garante padding suficiente (customize conforme seu layout)
                    selectEl.style.paddingLeft = '36px';
                } catch (e) {
                    selectEl.style.backgroundImage = '';
                }
            }

            // ligar evento change e chamar uma vez na inicializa√ß√£o
            selectEl.addEventListener('change', update);
            update();
        }

        // chamar para o select da categoria (ap√≥s options terem sido criadas)
        document.addEventListener('DOMContentLoaded', function () {
            // se as categorias s√£o populadas dinamicamente depois do DOMContentLoaded,
            // chame applyCategoryIconToNativeSelect(document.getElementById('orderform-category'))
            // logo ap√≥s a fun√ß√£o updateCategories terminar de inserir as options.
            const sel = document.getElementById('orderform-category');
            if (sel) applyCategoryIconToNativeSelect(sel);
        });

            // Atualiza visualmente qual op√ß√£o est√° selecionada na lista
            const allOptions = list.querySelectorAll('.custom-option');
            allOptions.forEach(opt => {
                opt.classList.remove('selected');
                opt.style.backgroundColor = '';
                opt.style.color = '#333';
            });

            if (sel && sel.value) {
                const selectedOption = Array.from(list.querySelectorAll('.custom-option')).find(opt => {
                    const span = opt.querySelector('span:last-child');
                    return span && span.textContent === sel.textContent;
                });
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                    selectedOption.style.backgroundColor = '#e8f0fe';
                    selectedOption.style.color = '#1a73e8';
                }
            }

            if (!iconVal) {
                iconImg.style.display = 'none';
                iconEmoji.style.display = 'none';
                return;
            }
            const isEmoji = iconVal.length <= 4 && /\p{Emoji}/u.test(iconVal);
            if (isEmoji) {
                iconEmoji.textContent = iconVal;
                iconEmoji.style.display = 'inline-block';
                iconImg.style.display = 'none';
            } else {
                iconImg.src = iconVal;
                iconImg.style.display = 'inline-block';
                iconEmoji.style.display = 'none';
            }

        btn.addEventListener('click', (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            if (list.style.display === 'block') {
                close();
            } else {
                open();
            }
        });

        btn.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter' || ev.key === ' ') {
                ev.preventDefault();
                if (list.style.display === 'block') {
                    close();
                } else {
                    open();
                }
            } else if (ev.key === 'Escape') {
                close();
            }
        });

        document.addEventListener('click', (ev) => {
            if (!wrapper.contains(ev.target)) {
                close();
            }
        });

        // Navega√ß√£o por teclado na lista
        list.addEventListener('keydown', (ev) => {
            const items = Array.from(list.querySelectorAll('.custom-option'));
            const currentIndex = items.findIndex(item => item === document.activeElement);

            switch (ev.key) {
                case 'ArrowDown':
                    ev.preventDefault();
                    const nextIndex = (currentIndex + 1) % items.length;
                    items[nextIndex]?.focus();
                    break;
                case 'ArrowUp':
                    ev.preventDefault();
                    const prevIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;
                    items[prevIndex]?.focus();
                    break;
                case 'Enter':
                case ' ':
                    ev.preventDefault();
                    document.activeElement?.click();
                    break;
                case 'Escape':
                    ev.preventDefault();
                    close();
                    btn.focus();
                    break;
            }
        });

        // insert into DOM: hide native select but keep it for form semantics
        selectEl.style.display = 'none';
        selectEl.parentNode.insertBefore(wrapper, selectEl);
        wrapper.appendChild(btn);
        wrapper.appendChild(list);

        // sync from outside changes
        selectEl.addEventListener('change', updateButton);

        // init
        updateButton()

        // Fun√ß√£o para selecionar automaticamente a primeira categoria
        function autoSelectFirstCategory(categories) {
            const categorySelect = document.getElementById('orderform-category');
            if (categorySelect && categorySelect.options.length > 1) {
                // Pular a primeira op√ß√£o (√≠ndice 0) que √© "Favorite services"
                // e selecionar a primeira categoria real (√≠ndice 1)
                categorySelect.selectedIndex = 1;

                // Disparar o evento change para filtrar os servi√ßos
                const event = new Event('change');
                categorySelect.dispatchEvent(event);
            }
        }

        // Fun√ß√£o para configurar event listeners dos servi√ßos
        function setupServiceEventListeners(services) {
            const categorySelect = document.getElementById('orderform-category');
            const serviceSelect = document.getElementById('orderform-service');
            const searchInput = document.getElementById('template-input');
            const quantityInput = document.getElementById('orderform-quantity');

            if (categorySelect) {
                categorySelect.addEventListener('change', function () {
                    filterServicesByCategory(this.value, services);
                });
            }

            if (serviceSelect) {
                serviceSelect.addEventListener('change', handleServiceChange);
            }

            if (searchInput) {
                searchInput.addEventListener('input', function () {
                    const searchTerm = this.value.toLowerCase();
                    const serviceSelect = document.getElementById('orderform-service');
                    const options = serviceSelect.querySelectorAll('option');

                    options.forEach(option => {
                        const text = option.textContent.toLowerCase();
                        if (text.includes(searchTerm) || option.value === '') {
                            option.style.display = '';
                        } else {
                            option.style.display = 'none';
                        }
                    });
                });
            }

            if (quantityInput) {
                quantityInput.addEventListener('input', handleQuantityChange);
            }
        }

        // Fun√ß√£o para filtrar servi√ßos por categoria
        function filterServicesByCategory(category, services) {
            const serviceSelect = document.getElementById('orderform-service');
            if (!serviceSelect) return;

            // Limpar op√ß√µes existentes
            serviceSelect.innerHTML = '';

            // Adicionar op√ß√£o padr√£o
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = category === '-1' ? 'Todos os servi√ßos' : 'Selecione um servi√ßo';
            serviceSelect.appendChild(defaultOption);

            // Filtrar e adicionar servi√ßos
            const filteredServices = category === '-1'
                ? services
                : services.filter(service => service.categoria === category);

            filteredServices.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id_servico;
                option.textContent = service.nome;
                option.setAttribute('data-price', service.preco_1000);
                option.setAttribute('data-min', service.minimo);
                option.setAttribute('data-max', service.maximo);
                option.setAttribute('data-description', service.descricao);
                option.setAttribute('data-rede', service.rede);
                option.setAttribute('data-tipo', service.tipo);
                serviceSelect.appendChild(option);
            });

            // Verificar se h√° um servi√ßo espec√≠fico na URL ap√≥s o filtro
            const urlParams = getUrlParams();
            const serviceIdFromUrl = urlParams.service;

            if (serviceIdFromUrl) {
                // Tentar selecionar o servi√ßo da URL mesmo ap√≥s o filtro
                const serviceExists = filteredServices.some(s => s.id_servico == serviceIdFromUrl);
                if (serviceExists) {
                    selectServiceById(serviceIdFromUrl, filteredServices);
                } else if (filteredServices.length > 0) {
                    // Se o servi√ßo da URL n√£o est√° na categoria filtrada, usar o primeiro dispon√≠vel
                    autoSelectFirstService(filteredServices);
                }
            } else if (filteredServices.length > 0) {
                // Preencher automaticamente com o primeiro servi√ßo ap√≥s filtro
                autoSelectFirstService(filteredServices);
            }
        }

        // Fun√ß√£o para lidar com mudan√ßa de servi√ßo
        function handleServiceChange() {
            const selectedOption = this.options[this.selectedIndex];
            const price = selectedOption.getAttribute('data-price');
            const description = selectedOption.getAttribute('data-description');
            const minQuantity = selectedOption.getAttribute('data-min');
            const maxQuantity = selectedOption.getAttribute('data-max');

            // Atualizar pre√ßo
            const quantityInput = document.getElementById('orderform-quantity');
            const currentQuantity = quantityInput ? quantityInput.value || minQuantity || 0 : 0;
            updateChargeField(price, currentQuantity);

            // Atualizar descri√ß√£o
            const descriptionPanel = document.querySelector('.panel-description');
            if (description && descriptionPanel) {
                descriptionPanel.innerHTML = description.replace(/\n/g, '<br>');
                const serviceDescription = document.getElementById('service_description');
                if (serviceDescription) {
                    serviceDescription.classList.remove('hidden');
                }
            } else if (descriptionPanel) {
                descriptionPanel.innerHTML = '';
                const serviceDescription = document.getElementById('service_description');
                if (serviceDescription) {
                    serviceDescription.classList.add('hidden');
                }
            }

            // Mostrar/ocultar campos de link e quantidade
            const linkField = document.getElementById('link_field');
            const quantityField = document.getElementById('quantity_field');

            if (selectedOption.value) {
                if (linkField) linkField.classList.remove('hidden');
                if (quantityField) quantityField.classList.remove('hidden');

                // Configurar limites da quantidade
                if (quantityInput) {
                    if (minQuantity) {
                        quantityInput.min = minQuantity;
                        quantityInput.placeholder = `M√≠nimo: ${minQuantity}`;
                    }
                    if (maxQuantity) {
                        quantityInput.max = maxQuantity;
                        quantityInput.placeholder = `M√≠nimo: ${minQuantity || 0}, M√°ximo: ${maxQuantity}`;
                    }

                    // Preencher quantidade m√≠nima automaticamente
                    if (minQuantity && !quantityInput.value) {
                        quantityInput.value = minQuantity;
                        updateChargeField(price, minQuantity);
                    }
                }
            } else {
                if (linkField) linkField.classList.add('hidden');
                if (quantityField) quantityField.classList.add('hidden');
            }
        }

        // Fun√ß√£o para lidar com mudan√ßa de quantidade
        function handleQuantityChange() {
            const serviceSelect = document.getElementById('orderform-service');
            if (!serviceSelect) return;

            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            const price = selectedOption ? selectedOption.getAttribute('data-price') : null;

            if (price) {
                updateChargeField(price, this.value);
            }
        }

        // --- Calcular total (robusto) ---
        function calculateTotal(pricePer1000, quantity) {
            const price = parseFloat(pricePer1000);
            const qty = parseInt(String(quantity).replace(/[^\d]/g, ''), 10);

            if (isNaN(price) || isNaN(qty) || qty <= 0) return 0;
            return (price * qty) / 1000;
        }

        function updateChargeField(pricePer1000, quantity) {
            const chargeInput = document.getElementById('charge');
            if (!chargeInput) return;

            const qty = parseInt(String(quantity).replace(/[^\d]/g, ''), 10);

            if (pricePer1000 && !isNaN(qty) && qty > 0) {
                const total = calculateTotal(pricePer1000, qty);
                chargeInput.value = `R$ ${total.toFixed(2)} (R$ ${parseFloat(pricePer1000).toFixed(2)} por 1000)`;
            } else if (pricePer1000) {
                chargeInput.value = `R$ ${parseFloat(pricePer1000).toFixed(2)} por 1000`;
            } else {
                chargeInput.value = '';
            }
        }

        // Fun√ß√£o para inicializar todos os campos com valores padr√£o
        function initializeDefaultFields() {
            const serviceSelect = document.getElementById('orderform-service');
            if (serviceSelect && serviceSelect.selectedIndex > 0) {
                // Garantir que os campos estejam vis√≠veis
                showServiceFields();

                // Disparar evento change para preencher todos os campos
                const event = new Event('change');
                serviceSelect.dispatchEvent(event);
            }
        }

        // Fun√ß√£o para mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notifyWrapper = document.getElementById('notify-wrapper');
            if (!notifyWrapper) return;

            notifyWrapper.textContent = message;
            notifyWrapper.className = `alert alert-${type} mb-3`;
            notifyWrapper.style.display = 'block';

            setTimeout(() => {
                notifyWrapper.style.display = 'none';
            }, 5000);
        }

        // Fun√ß√£o para mostrar mensagem de sucesso abaixo do container dos servi√ßos
        function showSuccessMessage(message) {
            // Remover mensagem anterior se existir
            const existingMessage = document.getElementById('success-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            // Criar nova mensagem
            const successMessage = document.createElement('div');
            successMessage.id = 'success-message';
            successMessage.className = 'success-message';

            // Adicionar classe espec√≠fica para mobile
            if (window.innerWidth < 992) {
                successMessage.classList.add('success-message-mobile');
            }

            successMessage.textContent = message;

            // Inserir no local correto baseado no tamanho da tela
            if (window.innerWidth < 992) {
                // Em dispositivos pequenos: inserir entre os containers
                const servicesContainer = document.querySelector('.new_order-block .col-lg-7');
                const contactContainer = document.querySelector('.new_order-block .col-lg-5');
                const rowContainer = document.querySelector('.new_order-block .row');

                if (rowContainer && servicesContainer && contactContainer) {
                    // Remover a mensagem existente primeiro
                    const existingMsg = document.getElementById('success-message');
                    if (existingMsg) existingMsg.remove();

                    // Criar uma nova linha para a mensagem
                    const messageRow = document.createElement('div');
                    messageRow.className = 'col-12';
                    messageRow.appendChild(successMessage);

                    // Inserir ap√≥s o container de servi√ßos e antes do container de contato
                    rowContainer.insertBefore(messageRow, contactContainer);
                }
            } else {
                // Em dispositivos grandes: inserir ap√≥s o container principal (comportamento original)
                const servicesContainer = document.querySelector('.new_order-block');
                if (servicesContainer) {
                    servicesContainer.parentNode.insertBefore(successMessage, servicesContainer.nextSibling);
                }
            }
        }

        // --- helper: escolhe endpoint baseado na rede ---
        function getApiEndpointForRede(rede) {
            if (!rede) return null;
            const r = String(rede).toLowerCase();
            if (r.includes('tiktok')) return 'https://smmsociais.com/api/criar_acao_tiktok';
            if (r.includes('instagram')) return 'https://smmsociais.com/api/criar_acao_instagram';
            // se quiser adicionar outras redes no futuro, acrescente aqui
            return null;
        }

        // criarAcao agora aceita endpoint opcional (string com URL completa)
        async function criarAcao(formData, tokenOpcional = null, endpoint = null) {
            const token = tokenOpcional || loadToken();
            if (!token) {
                throw new Error('Token de autentica√ß√£o n√£o encontrado');
            }

            // escolhe endpoint padr√£o se n√£o passado
            const url = endpoint || 'https://smmsociais.com/api/criar_acao_tiktok';

            console.log('‚Üí criarAcao endpoint:', url, ' token:', Boolean(token));

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    // tenta ler texto primeiro (mais seguro), depois JSON
                    const text = await response.text().catch(() => null);
                    let errorMsg = text || `HTTP ${response.status}`;
                    try {
                        const json = text ? JSON.parse(text) : null;
                        if (json && json.error) errorMsg = json.error;
                    } catch (e) { /* n√£o-JSON */ }

                    console.error('criar_acao response NOT OK:', response.status, errorMsg);
                    if (response.status === 401) {
                        throw new Error('N√£o autorizado');
                    }
                    throw new Error(errorMsg || 'Erro ao criar a√ß√£o');
                }

                const result = await response.json();
                return result;

            } catch (error) {
                console.error('Erro na cria√ß√£o da a√ß√£o:', error);
                throw error;
            }
        }

        // --- Ao mudar de servi√ßo, configurar min/max corretamente ---
        function handleServiceChange() {
            const selectedOption = this.options[this.selectedIndex];
            if (!selectedOption) return;

            const price = selectedOption.getAttribute('data-price');
            const description = selectedOption.getAttribute('data-description');
            const minAttr = selectedOption.getAttribute('data-min');
            const maxAttr = selectedOption.getAttribute('data-max');

            // convers√£o segura de limites
            const minQuantity = (minAttr !== null && minAttr !== '') ? parseInt(minAttr, 10) : null;
            const maxQuantity = (maxAttr !== null && maxAttr !== '') ? parseInt(maxAttr, 10) : null;

            // Atualizar pre√ßo
            const quantityInput = document.getElementById('orderform-quantity');
            const currentQuantity = quantityInput ? quantityInput.value || (minQuantity !== null ? minQuantity : '') : '';
            updateChargeField(price, currentQuantity);

            // Atualizar descri√ß√£o
            const descriptionPanel = document.querySelector('.panel-description');
            if (description && descriptionPanel) {
                descriptionPanel.innerHTML = description.replace(/\n/g, '<br>');
                const serviceDescription = document.getElementById('service_description');
                if (serviceDescription) {
                    serviceDescription.classList.remove('hidden');
                }
            } else if (descriptionPanel) {
                descriptionPanel.innerHTML = '';
                const serviceDescription = document.getElementById('service_description');
                if (serviceDescription) {
                    serviceDescription.classList.add('hidden');
                }
            }

            // Mostrar/ocultar campos de link e quantidade
            const linkField = document.getElementById('link_field');
            const quantityField = document.getElementById('quantity_field');

            if (selectedOption.value) {
                if (linkField) linkField.classList.remove('hidden');
                if (quantityField) quantityField.classList.remove('hidden');

                // Configurar limites da quantidade no input de forma segura
                if (quantityInput) {
                    if (minQuantity !== null) {
                        quantityInput.min = minQuantity;
                        quantityInput.placeholder = `M√≠nimo: ${minQuantity}`;
                    } else {
                        quantityInput.removeAttribute('min');
                    }

                    if (maxQuantity !== null) {
                        quantityInput.max = maxQuantity;
                        // placeholder j√° mostra m√≠nimo; vamos juntar info se existir max
                        const minText = minQuantity !== null ? `M√≠nimo: ${minQuantity}, ` : '';
                        quantityInput.placeholder = `${minText}M√°ximo: ${maxQuantity}`;
                    } else {
                        quantityInput.removeAttribute('max');
                    }

                    // Preencher quantidade m√≠nima automaticamente se estiver vazio
                    if (minQuantity !== null && !quantityInput.value) {
                        quantityInput.value = minQuantity;
                        updateChargeField(price, minQuantity);
                    }
                }
            } else {
                if (linkField) linkField.classList.add('hidden');
                if (quantityField) quantityField.classList.add('hidden');
            }
        }

        // --- Ao mudar a quantidade pelo input ---
        function handleQuantityChange() {
            const serviceSelect = document.getElementById('orderform-service');
            if (!serviceSelect) return;

            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            const price = selectedOption ? selectedOption.getAttribute('data-price') : null;

            // sanitiza a quantidade para n√∫meros antes de atualizar
            const raw = this.value;
            const sanitized = raw ? String(raw).replace(/[^\d]/g, '') : '';
            if (sanitized !== raw) {
                // opcional: atualiza o campo para remover chars inv√°lidos
                this.value = sanitized;
            }

            if (price) {
                updateChargeField(price, sanitized);
            }
        }

        // --- Envio do formul√°rio com valida√ß√£o num√©rica correta (ajustada para escolher rota) ---
        async function handleFormSubmit(event) {
            event.preventDefault();

            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton ? submitButton.textContent : 'Enviar';

            try {
                if (submitButton) {
                    submitButton.textContent = 'Enviando...';
                    submitButton.disabled = true;
                }
                document.body.classList.add('loading');

                // Obter dados do formul√°rio
                const serviceSelect = document.getElementById('orderform-service');
                if (!serviceSelect || !serviceSelect.value) {
                    throw new Error('Por favor, selecione um servi√ßo');
                }
                const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];

                const linkInput = document.getElementById('orderform-link');
                const link = linkInput ? linkInput.value.trim() : '';
                if (!link) throw new Error('Por favor, informe o link');

                const quantityInput = document.getElementById('orderform-quantity');
                const quantityRaw = quantityInput ? quantityInput.value : '';
                const quantity = parseInt(String(quantityRaw).replace(/[^\d]/g, ''), 10);

                const minAttr = selectedOption.getAttribute('data-min');
                const maxAttr = selectedOption.getAttribute('data-max');
                const minQuantity = (minAttr !== null && minAttr !== '') ? parseInt(minAttr, 10) : null;
                const maxQuantity = (maxAttr !== null && maxAttr !== '') ? parseInt(maxAttr, 10) : null;

                // Valida√ß√µes num√©ricas
                if (isNaN(quantity) || quantity <= 0) {
                    throw new Error('Quantidade inv√°lida para este servi√ßo');
                }
                if (minQuantity !== null && quantity < minQuantity) {
                    throw new Error(`Quantidade abaixo do m√≠nimo (${minQuantity})`);
                }
                if (maxQuantity !== null && quantity > maxQuantity) {
                    throw new Error(`Quantidade acima do m√°ximo (${maxQuantity})`);
                }

                const pricePer1000 = selectedOption.getAttribute('data-price');
                const totalValue = calculateTotal(pricePer1000, quantity);

                // Obter informa√ß√µes do usu√°rio
                const userInfo = await getUserInfo();
                if (!userInfo || !(userInfo.userId || userInfo.id || userInfo._id || userInfo.token)) {
                    throw new Error('N√£o foi poss√≠vel obter informa√ß√µes do usu√°rio');
                }

                // Detectar endpoint com base na rede do servi√ßo
                const redeAttr = selectedOption.getAttribute('data-rede') || '';
                const apiEndpoint = getApiEndpointForRede(redeAttr);

                if (!apiEndpoint) {
                    throw new Error(`Rede desconhecida ou n√£o suportada: "${redeAttr}". Contate o suporte.`);
                }

                // Preparar dados para a API
                const actionData = {
                    rede: redeAttr,
                    tipo: selectedOption.getAttribute('data-tipo'),
                    nome: selectedOption.textContent,
                    valor: totalValue,
                    quantidade: parseInt(quantity, 10),
                    link: link,
                    userId: userInfo.userId,
                    id_servico: serviceSelect.value
                };

                // Chamar API para criar a√ß√£o no endpoint correto
                const result = await criarAcao(actionData, null, apiEndpoint);

                // Se a API retornou novo saldo, atualiza o display IMEDIATAMENTE
                if (result && typeof result.newSaldo !== 'undefined') {
                    const balanceElement = document.querySelector('.component-navbar-balance-item__navbar-private');
                    if (balanceElement) {
                        const formatted = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(result.newSaldo || 0);
                        balanceElement.textContent = formatted;
                    }
                } else {
                    // fallback: recarrega saldo do servidor
                    await loadUserBalance();
                }

                // Mostrar notifica√ß√£o e mensagem de sucesso
                showNotification(`Pedido criado com sucesso! ID: ${result.id_pedido}`, 'success');
                showSuccessMessage(`Pedido enviado com sucesso! ID: ${result.id_pedido}`);

                // Limpar apenas os campos espec√≠ficos, mantendo o container expandido
                const chargeInput = document.getElementById('charge');
                if (chargeInput) chargeInput.value = '';

                const linkInputField = document.getElementById('orderform-link');
                if (linkInputField) linkInputField.value = ''; // Remove apenas o valor do link

                // N√ÉO esconder os campos para manter o container expandido

            } catch (error) {
                console.error('Erro ao processar pedido:', error);
                showNotification(error.message || 'Erro ao processar pedido', 'danger');
            } finally {
                if (submitButton) {
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                }
                document.body.classList.remove('loading');
            }
        }

        // Configurar event listener para o formul√°rio
        document.addEventListener('DOMContentLoaded', function () {
            const orderForm = document.getElementById('order-form');
            if (orderForm) {
                orderForm.addEventListener('submit', handleFormSubmit);
            }

            // Reaplicar o posicionamento da mensagem quando a janela for redimensionada
            window.addEventListener('resize', function () {
                const existingMessage = document.getElementById('success-message');
                if (existingMessage) {
                    const messageText = existingMessage.textContent;
                    existingMessage.remove();
                    showSuccessMessage(messageText);
                }
            });
        });

        // Guarda servi√ßos carregados globalmente para o search
        window._services = window._services || [];

        // Debounce helper
        function debounce(fn, wait = 180) {
            let t;
            return function (...args) {
                clearTimeout(t);
                t = setTimeout(() => fn.apply(this, args), wait);
            };
        }

        // Retorna emoji/√≠cone por rede/tipo simples
        function getIconForService(service) {
            const r = (service.rede || '').toLowerCase();
            const t = (service.tipo || '').toLowerCase();
            if (r.includes('instagram') || t.includes('instagram')) return 'üì∑';
            if (r.includes('tiktok') || t.includes('tiktok')) return 'üôé‚Äç‚ôÇÔ∏è';
            if (r.includes('youtube') || t.includes('youtube')) return '‚ñ∂Ô∏è';
            if (r.includes('facebook') || t.includes('facebook')) return 'üë•';
            return 'üîß';
        }

        // Filtra servi√ßos por termo (prioriza startsWith depois includes)
        function filterServicesBySearchTerm(term, services) {
            term = String(term || '').trim().toLowerCase();
            if (!term) return [];
            const starts = [];
            const contains = [];
            services.forEach(s => {
                const hay = `${s.nome || ''} ${s.descricao || ''} ${s.rede || ''} ${s.tipo || ''}`.toLowerCase();
                if (hay.startsWith(term)) starts.push(s);
                else if (hay.includes(term)) contains.push(s);
            });
            return starts.concat(contains);
        }

        // Renderiza a lista de resultados abaixo do input
        function renderSearchResults(results) {
            let container = document.getElementById('service-search-results');
            if (!container) {
                const searchInput = document.getElementById('template-input');
                container = document.createElement('div');
                container.id = 'service-search-results';
                if (searchInput && searchInput.parentNode) {
                    searchInput.parentNode.insertBefore(container, searchInput.nextSibling);
                } else {
                    document.body.appendChild(container);
                }
            }

            container.innerHTML = '';

            if (!results || results.length === 0) {
                const no = document.createElement('div');
                no.className = 'search-no-results';
                no.textContent = 'Nenhum servi√ßo encontrado.';
                container.appendChild(no);
                return;
            }

            // limita resultados para evitar scroll gigantesco
            const max = 25;
            results.slice(0, max).forEach(service => {
                const item = document.createElement('div');
                item.className = 'service-result-item';
                item.tabIndex = 0;
                item.setAttribute('data-id', service.id_servico);

                const icon = document.createElement('div');
                icon.className = 'service-result-icon';
                icon.textContent = getIconForService(service);

                const body = document.createElement('div');
                body.className = 'service-result-body';

                const title = document.createElement('div');
                title.className = 'service-result-title';
                // Exemplo: "üì∑Seguidores Instagram (Menor Queda no momento)"
                title.textContent = service.nome;

                const sub = document.createElement('div');
                sub.className = 'service-result-sub';
                const noteParts = [];
                if (service.rede) noteParts.push(service.rede);
                if (service.tipo) noteParts.push(service.tipo);
                if (service.descricao) noteParts.push(String(service.descricao).slice(0, 80));
                sub.textContent = noteParts.join(' ‚Ä¢ ');

                body.appendChild(title);
                body.appendChild(sub);

                item.appendChild(icon);
                item.appendChild(body);

                // sele√ß√£o: ao clicar seleciona o servi√ßo no select e fecha a lista
                item.addEventListener('click', function () {
                    // tenta selecionar usando a fun√ß√£o j√° existente selectServiceById
                    try {
                        selectServiceById(service.id_servico, window._services);
                    } catch (e) {
                        // fallback: seta value diretamente
                        const serviceSelect = document.getElementById('orderform-service');
                        if (serviceSelect) {
                            for (let i = 0; i < serviceSelect.options.length; i++) {
                                if (String(serviceSelect.options[i].value) === String(service.id_servico)) {
                                    serviceSelect.selectedIndex = i;
                                    serviceSelect.dispatchEvent(new Event('change'));
                                    break;
                                }
                            }
                        }
                    }
                    // esconde a lista
                    const container = document.getElementById('service-search-results');
                    if (container) container.innerHTML = '';
                });

                // keyboard support: Enter to select
                item.addEventListener('keydown', function (ev) {
                    if (ev.key === 'Enter') {
                        ev.preventDefault();
                        this.click();
                    }
                });

                container.appendChild(item);
            });
        }

        // Replace / enhance setupServiceEventListeners
        function setupServiceEventListeners(services) {
            // keep global copy for other functions
            window._services = services || window._services || [];

            const categorySelect = document.getElementById('orderform-category');
            const serviceSelect = document.getElementById('orderform-service');
            const searchInput = document.getElementById('template-input');
            const quantityInput = document.getElementById('orderform-quantity');

            if (categorySelect) {
                categorySelect.addEventListener('change', function () {
                    filterServicesByCategory(this.value, services);
                    // limpa resultados do search quando categoria muda
                    const sr = document.getElementById('service-search-results');
                    if (sr) sr.innerHTML = '';
                });
            }

            if (serviceSelect) {
                serviceSelect.addEventListener('change', handleServiceChange);
            }

            // cria container de resultados se n√£o existir
            (function ensureResultContainer() {
                if (!document.getElementById('service-search-results')) {
                    const searchInputEl = document.getElementById('template-input');
                    if (searchInputEl) {
                        const container = document.createElement('div');
                        container.id = 'service-search-results';
                        searchInputEl.parentNode.insertBefore(container, searchInputEl.nextSibling);
                        container.innerHTML = '';
                    }
                }
            })();

            if (searchInput) {
                // comportamento: ao digitar, filtra e exibe sugest√µes
                const onInput = debounce(function () {
                    const term = this.value || '';
                    if (!term.trim()) {
                        // vazio ‚Äî esconde resultados e restaura options vis√≠veis
                        const sr = document.getElementById('service-search-results');
                        if (sr) sr.innerHTML = '';
                        // also restore option display if you used the previous option hide approach
                        const serviceSelect = document.getElementById('orderform-service');
                        if (serviceSelect) {
                            Array.from(serviceSelect.options).forEach(opt => opt.style.display = '');
                        }
                        return;
                    }
                    const filtered = filterServicesBySearchTerm(term, window._services || []);
                    renderSearchResults(filtered);
                    // opcional: highlight matched options in select (keeps accessibility)
                    const serviceSelectEl = document.getElementById('orderform-service');
                    if (serviceSelectEl) {
                        Array.from(serviceSelectEl.options).forEach(opt => {
                            const hay = opt.textContent.toLowerCase();
                            opt.style.display = hay.includes(term.toLowerCase()) ? '' : 'none';
                        });
                    }
                }, 160);

                searchInput.addEventListener('input', onInput);

                // limpar resultados quando input perde foco (com pequeno delay para clique funcionar)
                searchInput.addEventListener('blur', function () {
                    setTimeout(() => {
                        const sr = document.getElementById('service-search-results');
                        if (sr) sr.innerHTML = '';
                    }, 180);
                });

                // se o usu√°rio clicar no campo, mostra sugest√µes r√°pidas baseadas no valor atual
                searchInput.addEventListener('focus', function () {
                    const term = this.value || '';
                    if (term.trim()) {
                        const filtered = filterServicesBySearchTerm(term, window._services || []);
                        renderSearchResults(filtered);
                    }
                });
            }

            if (quantityInput) {
                quantityInput.addEventListener('input', handleQuantityChange);
            }
        }

    </script>
    <link rel="stylesheet" type="text/css" href="https://storage.perfectcdn.com/global/tad3g2kcwfrtr6yi.css">
    <link rel="stylesheet" type="text/css" href="https://storage.perfectcdn.com/ahnerj/2pcamz1sqmak1hf9.css">
    <script>
        window.modules = {};
    </script>
</head>

<body class="body  body-internal">
    <div class="wrapper  wrapper-sidebar-navbar ">
        <div id="block_52" class="component_private_navbar">
            <span class="component_private_navbar ">
                <div class="component_private_navbar__wrapper component_private_sidebar ">
                    <div
                        class="sidebar-block__top component-navbar component-navbar__navbar-private editor__component-wrapper ">
                        <div>
                            <nav class="navbar navbar-expand-lg navbar-light">
                                <div class="navbar-private__header">
                                    <div class="sidebar-block__top-brand">
                                        <a href="/painel.html"
                                            class="component-navbar-brand component-navbar-public-brand">
                                            <h3><strong style="font-weight: bold"></strong><span
                                                    style="color: var(--color-id-117)"><strong
                                                        style="font-weight: bold">SMM SOCIAIS</strong></span></h3>
                                        </a>
                                    </div>
                                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                                        data-target="#navbar-collapse-52" aria-controls="navbar-collapse-52"
                                        aria-expanded="false" aria-label="Toggle navigation">
                                        <span class="navbar-burger">
                                            <span class="navbar-burger-line"></span>
                                        </span>
                                    </button>
                                </div>
                                <div class="collapse navbar-collapse" id="navbar-collapse-52">
                                    <div class="component-navbar-collapse-divider"></div>
                                    <div class="d-flex component-navbar-collapse">
                                        <ul class="navbar-nav navbar-nav-sidebar-menu">
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private component-navbar-nav-link-active__navbar-private"
                                                    href="/">
                                                    Novo pedido
                                                </a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private "
                                                    href="/services">
                                                    Servi√ßos
                                                </a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private "
                                                    href="/orders">
                                                    Ordens
                                                </a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private "
                                                    href="/addfunds">
                                                    Adicionar Saldo
                                                </a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private "
                                                    href="/affiliates">
                                                    Meus indicados
                                                </a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private "
                                                    href="/massorder">
                                                    Mass order
                                                </a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private "
                                                    href="/suporte">
                                                    Suporte
                                                </a>
                                            </li>
                                        </ul>
                                        <ul class="navbar-nav navbar-nav-currencies">
                                            <li
                                                class="nav-item d-flex align-items-center component-navbar-nav-item component-navbar-private-nav-item component-navbar-balance-wrap__navbar-private">
                                                <a class="component-navbar-balance-item__navbar-private">R$ 0,00</a>
                                            </li>
                                        </ul>
                                        <ul class="navbar-nav">
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private"
                                                    href="/account">Conta</a>
                                            </li>
                                            <li
                                                class="nav-item component-navbar-nav-item component-navbar-private-nav-item">
                                                <a class="component-navbar-nav-link  component-navbar-nav-link__navbar-private"
                                                    href="/">Sair</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </nav>
                        </div>
                    </div>
                </div>
            </span>
            <span class="component_private_sidebar ">
                <div class="component-sidebar_wrapper">
                    <div
                        class="sidebar-block__left component-sidebar component-sidebar-with-navbar component_private_navbar editor__component-wrapper">
                        <div class="component-sidebar__menu">
                            <div class="component-sidebar__menu-logo">
                                <a href="/painel" class="component-navbar-brand component-sidebar__menu-brand">
                                    <h3><strong style="font-weight: bold">SMM </strong><span
                                            style="font-weight: bold">SOCIAIS</strong></span></h3>
                                </a>
                            </div>
                            <ul class="sidebar-block__left-menu editor__component-wrapper">
                                <li class="component-sidebar__menu-item component-sidebar__menu-item-active">
                                    <a class="component-sidebar__menu-item-link" href="/">
                                        Novo pedido
                                    </a>
                                </li>
                                <li class="component-sidebar__menu-item ">
                                    <a class="component-sidebar__menu-item-link" href="/services">
                                        Servi√ßos
                                    </a>
                                </li>
                                <li class="component-sidebar__menu-item ">
                                    <a class="component-sidebar__menu-item-link" href="/orders">
                                        Ordens
                                    </a>
                                </li>
                                <li class="component-sidebar__menu-item ">
                                    <a class="component-sidebar__menu-item-link" href="/addfunds">
                                        Adicionar Saldo
                                    </a>
                                </li>
                                <li class="component-sidebar__menu-item ">
                                    <a class="component-sidebar__menu-item-link" href="/affiliates">
                                        Meus indicados
                                    </a>
                                </li>
                                <li class="component-sidebar__menu-item ">
                                    <a class="component-sidebar__menu-item-link" href="/massorder">
                                        Mass order
                                    </a>
                                </li>
                                <li class="component-sidebar__menu-item ">
                                    <a class="component-sidebar__menu-item-link" href="/suporte">
                                        Suporte
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </span>
        </div>
        <div class="wrapper-content">
            <div class="wrapper-content__header">
            </div>
            <div class="wrapper-content__body">
                <!-- Main variables *content* -->
                <div id="block_60">
                    <div class="block-bg"></div>
                    <div class="container-fluid">
                        <div class="new_order-block ">
                            <div class="row">
                                <div class="col-lg-7 mb-3 mb-lg-0">
                                    <div
                                        class="component_form_group component_card component_radio_button component_platforms">
                                        <div class="card ">
                                            <form action="/" method="post" id="order-form">
                                                <div class="component_button_forms">
                                                    <div class="form-group">
                                                        <div class="search-dropdown" id="new-order-search"
                                                            style="position: relative;"
                                                            data-lang-placeholder="Procurar">
                                                            <div class="input-wrapper" style="position: relative;">
                                                                <button
                                                                    style="position: absolute;top: 50%;transform: translateY(-50%);padding: 0px 2px;background: none;border: none;left: 12px;"
                                                                    type="button">
                                                                    <span class="fas fa-search"></span>
                                                                </button>
                                                                <input type="text" class="form-control"
                                                                    id="template-input" value="" placeholder="Procurar">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="orderform-category"
                                                            class="control-label">Categoria</label>
                                                        <select class="form-control" id="orderform-category"
                                                            name="OrderForm[category]" data-select="true"
                                                            data-select-search="true"
                                                            data-select-search-placeholder="Procurar"
                                                            data-select-container="#select-category-container">
                                                            <option value="-1" data-icon="
                                                                                              <span class='fas fa-star'></span>
                                                                                         " selected>
                                                                Favorite services
                                                            </option>
                                                            <!-- Categorias ser√£o preenchidas dinamicamente -->
                                                        </select>
                                                        <div id="select-category-container" class="position-relative">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="orderform-service"
                                                            class="control-label">Servi√ßo</label>
                                                        <div class="d-flex">
                                                            <div class="w-100 new_order-block__services-list">
                                                                <select class="form-control" id="orderform-service"
                                                                    name="OrderForm[service]" data-select="true"
                                                                    data-select-search="true"
                                                                    data-select-search-placeholder="Procurar"
                                                                    data-select-container="#select-service-container">
                                                                    <option value="" selected>Carregando servi√ßos...
                                                                    </option>
                                                                </select>
                                                                <div id="select-service-container"
                                                                    class="position-relative"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group hidden fields component_service_description"
                                                        id="service_description">
                                                        <label for="service_description"
                                                            class="control-label">Descri√ß√£o</label>
                                                        <div class="panel-description">

                                                        </div>
                                                    </div>
                                                    <!-- Campos adicionados: Link e Quantidade -->
                                                    <div class="form-group hidden" id="link_field">
                                                        <label for="orderform-link" class="control-label">Link</label>
                                                        <input type="text" class="form-control" id="orderform-link"
                                                            name="OrderForm[link]" placeholder="Cole o link aqui">
                                                    </div>
                                                    <div class="form-group hidden" id="quantity_field">
                                                        <label for="orderform-quantity"
                                                            class="control-label">Quantidade</label>
                                                        <input type="number" class="form-control"
                                                            id="orderform-quantity" name="OrderForm[quantity]"
                                                            placeholder="Digite a quantidade" min="0">
                                                    </div>
                                                    <div id="fields"></div>
                                                    <div class="form-group">
                                                        <label for="charge" class="control-label">Valor</label>
                                                        <input type="text" class="form-control" id="charge" value=""
                                                            readonly>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="_csrf"
                                                    value="Xbole38fGiDW4C4919TBihZOb3zsg6y7CdYCRlPW1hAqzX0tNW9zTe-SenyHhY7HIQEeG8Ht3NZ8gnURPbHmRg==">
                                                <div class="new-order-button-submit component_button_submit ">
                                                    <button type="submit"
                                                        class="btn btn-block btn-big-primary">Enviar</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-5">
                                    <div class="component_content_card component_content_button">
                                        <div class="card">
                                            <div class="new-order__content-title">
                                                <div class="position-relative">
                                                    <p>Para usar nossos servi√ßos clique em <a target="_self"
                                                            href="/addfunds">"Adicionar saldo"</a> ou <a target="_self"
                                                            href="/addfunds">aqui</a></p>
                                                    <p><br></p>
                                                    <p><br></p>
                                                    <p>Aceitamos somente <a target="_self" href="/addfunds">Pix</a> <a
                                                            target="_self" href="/addfunds">- clique aqui para
                                                            recarregar o &nbsp;seu saldo - </a>(Tudo integrado de forma
                                                        autom√°tica, ou seja, voc√™ faz o Pix e ele entra no seu saldo na
                                                        mesma hora! Se atente a usar a op√ß√£o "Pix copia e cola"</p>
                                                    <p>Caso voc√™ N√ÉO saiba utilizar a op√ß√£o "Copia e cola" do Pix, <a
                                                            target="_blank"
                                                            href="https://www.youtube.com/watch?v=YIenNQLvb9g">clique
                                                            aqui</a></p>
                                                    <p><br></p>
                                                    <p>Estamos dando 10% de comiss√£o para todas as compras que seus
                                                        amigos fizerem tendo se cadastrado no seu link! Para entender
                                                        melhor <a target="_self" href="/affiliates">clique aqui</a></p>
                                                </div>
                                            </div>
                                            <div class="new-order__content-text">
                                                <p>Somos uma empresa de publicidade digital, com diversos servi√ßos √† sua
                                                    disposi√ß√£o para alavancar seu perfil nas redes sociais,
                                                    proporcionando novas oportunidades para voc√™ ou sua empresa!&nbsp;
                                                </p>
                                                <p>Suporte das 6:30 at√© √†s 22 horas de segunda-feira a sexta-feira</p>
                                                <p><br></p>
                                                <h1>CONTATO</h1>
                                                <p><br></p>
                                                <p><br></p>
                                                <p><strong style="font-weight: bold">E-mail</strong>:
                                                    contato@smmsociais.com</p>
                                                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nosso Instagram √© <a target="_blank"
                                                        href="https://www.instagram.com/smmsociais/">@smmsociais</a>
                                                    &nbsp;</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="block_74">
                    <div class="block-bg"></div>
                    <div class="container">
                        <div class="text-block-with-image ">
                            <div class="row">
                                <div class="col">
                                    <div class="d-md-flex align-items-start">
                                        <div class="text-block__description">
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            </p>
                                            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
                                            <p class="text-left"><span style="text-align: LEFT">Ao acessar ao site ,
                                                    voc√™ concorda em cumprir os nossos termos de servi√ßo assim como
                                                    todas as leis e regulamentos aplic√°veis ‚Äã‚Äãe concorda que √©
                                                    respons√°vel pelo cumprimento de todas as leis locais aplic√°veis. Se
                                                    voc√™ n√£o concordar com algum desses termos, est√° proibido de usar ou
                                                    acessar este site. Os materiais contidos neste site s√£o protegidos
                                                    pelas leis de direitos autorais e mardas comerciais aplic√°veis.
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            </p>
                                        </div>
                                        <div class="text-block__image">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                </a>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    <div class="wrapper-content__footer">
    </div>
    </div>
    </div>
    <!-- Notifications wrapper -->
    <div id="notify-wrapper" class="alert alert-success mb-3 hidden" style="display: none;"></div>

    <!-- ======= Navbar toggle fallback (vanilla JS) - torna o "hamburger" funcional em dispositivos m√≥veis ======= -->
    <script>
        (function () {
            // Fun√ß√£o utilit√°ria para encontrar o alvo do bot√£o (data-target ou aria-controls)
            function resolveTarget(button) {
                const targetSelector = button.getAttribute('data-target') || button.getAttribute('data-bs-target') || ('#' + (button.getAttribute('aria-controls') || ''));
                if (!targetSelector) return null;
                try {
                    return document.querySelector(targetSelector);
                } catch (e) {
                    return null;
                }
            }

            // Inicializa todos os togglers de navbar existentes
            function initNavTogglers() {
                const togglers = document.querySelectorAll('.navbar-toggler');
                togglers.forEach(btn => {
                    const target = resolveTarget(btn);
                    if (!target) return;

                    // Garantir que o bot√£o tenha type="button" para evitar submit acidental
                    if (!btn.hasAttribute('type')) btn.setAttribute('type', 'button');

                    // Evitar duplicar event listeners
                    if (btn.__nav_init) return;
                    btn.__nav_init = true;

                    btn.addEventListener('click', function (e) {
                        e.preventDefault();
                        const isShown = target.classList.contains('show');
                        if (isShown) {
                            target.classList.remove('show');
                            btn.classList.remove('collapsed');
                            btn.setAttribute('aria-expanded', 'false');
                        } else {
                            target.classList.add('show');
                            btn.classList.add('collapsed');
                            btn.setAttribute('aria-expanded', 'true');
                        }
                    });

                    // Fechar ao clicar fora (somente se estiver aberto)
                    document.addEventListener('click', function (ev) {
                        if (!target.classList.contains('show')) return;
                        if (btn.contains(ev.target) || target.contains(ev.target)) return;
                        target.classList.remove('show');
                        btn.setAttribute('aria-expanded', 'false');
                    });

                    // Fechar ao pressionar ESC
                    document.addEventListener('keydown', function (ev) {
                        if (ev.key === 'Escape' && target.classList.contains('show')) {
                            target.classList.remove('show');
                            btn.setAttribute('aria-expanded', 'false');
                        }
                    });

                    // Ao redimensionar para telas grandes, garantir menu fechado
                    window.addEventListener('resize', function () {
                        if (window.innerWidth >= 992 && target.classList.contains('show')) {
                            target.classList.remove('show');
                            btn.setAttribute('aria-expanded', 'false');
                        }
                    });
                });
            }

            // Inicializar no DOM ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initNavTogglers);
            } else {
                initNavTogglers();
            }
        })();
    </script>

    <!-- Script para garantir que a p√°gina apare√ßa apenas ap√≥s todas as APIs terminarem -->
    <script>
        (function () {
            // mostra um overlay loader enquanto aguarda
            const loader = document.createElement('div');
            loader.id = 'page-loader';
            loader.innerHTML = `
                <div style="text-align:center">
                    <div class="spinner-border" role="status" aria-hidden="true"></div>
                    <div style="margin-top:8px">Carregando dados...</div>
                </div>`;
            document.body.appendChild(loader);

            // --- opcional: esperar window.load para garantir recursos externos carregados ---
            const windowLoadPromise = new Promise(resolve => {
                if (document.readyState === 'complete') return resolve();
                window.addEventListener('load', resolve);
            });

            // Executar fillAndHideInput imediatamente (n√£o depende de APIs)
            fillAndHideInput();

            // --- Promise principal: saldo + servi√ßos (+ window.load) ---
            const saldoPromise = loadUserBalance();
            const servicesPromise = loadServices();

            Promise.all([saldoPromise, servicesPromise, windowLoadPromise])
                .then(() => {
                    document.body.classList.add('loaded');

                    // Inicializar campos com valores padr√£o ap√≥s um pequeno delay
                    // para garantir que o DOM esteja completamente renderizado
                    setTimeout(() => {
                        initializeDefaultFields();
                    }, 100);
                })
                .catch(err => {
                    // se algo muito inesperado acontecer, logamos e mostramos a p√°gina (UX)
                    console.error('Erro ao carregar dados principais:', err);
                    document.body.classList.add('loaded');
                    const serviceSelect = document.getElementById('orderform-service');
                    if (serviceSelect && serviceSelect.innerHTML.includes('Carregando servi√ßos')) {
                        serviceSelect.innerHTML = '<option value="">Erro ao carregar servi√ßos</option>';
                    }
                })
                .finally(() => {
                    // remover loader visual
                    if (loader && loader.parentNode) loader.parentNode.removeChild(loader);
                });

            // Seguran√ßa extra: fallback para evitar tela eternamente oculta (ex.: bloqueio de CORS extremo)
            setTimeout(() => {
                if (!document.body.classList.contains('loaded')) {
                    console.warn('Fallback: exibindo p√°gina ap√≥s timeout.');
                    document.body.classList.add('loaded');
                    if (loader && loader.parentNode) loader.parentNode.removeChild(loader);
                }
            }, 15000); // 15s ‚Äî opcional, ajuste conforme necessidade
        })();
    </script>

    <!-- Bot√£o do WhatsApp para suporte -->
    <a href="https://wa.me/5582999801112?text=Ol√°,%20preciso%20de%20ajuda" target="_blank" id="whatsapp-button">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg" alt="WhatsApp">
    </a>
</body>

</html>
